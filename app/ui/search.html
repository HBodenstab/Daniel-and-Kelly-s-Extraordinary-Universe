<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search - Daniel & Kelly's Extraordinary Universe</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Cdefs%3E%3CradialGradient id='g' cx='50%25' cy='50%25' r='60%25'%3E%3Cstop offset='0%25' stop-color='%2300E6FF'/%3E%3Cstop offset='100%25' stop-color='%230B1D3A'/%3E%3C/radialGradient%3E%3C/defs%3E%3Ccircle cx='32' cy='32' r='30' fill='url(%23g)'/%3E%3Cpath d='M14 34c10-2 26-2 36 0M22 22l-4-6m6 4l-6 4M46 46l6 4m-4-6l4-6' stroke='%23FFFFFF' stroke-width='2' stroke-linecap='round' fill='none' opacity='.7'/%3E%3C/svg%3E">
    <style>
        *{box-sizing:border-box;margin:0;padding:0}
        body{color:#fff;background:radial-gradient(1200px 800px at 70% -10%, rgba(122,79,255,.25), transparent 60%),linear-gradient(180deg, #0B1D3A 0%, #0A1830 100%);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
        .site-header{max-width:72rem;margin:0 auto;display:flex;align-items:center;justify-content:space-between;padding:24px}
        .brand{font-weight:700;letter-spacing:.2px;color:#BBD7FF;text-decoration:none}
        .nav a{color:#CFE6FF;text-decoration:none;margin-left:16px;opacity:.9}
        .nav a:hover{opacity:1;color:#00E6FF;transform:translateY(-1px)}
        .search-container{max-width:72rem;margin:0 auto;padding:32px 24px}
        
        /* Animations */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideInFromLeft {
            from {
                opacity: 0;
                transform: translateX(-30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        /* Animation classes */
        .animate-fade-in-up {
            animation: fadeInUp 0.8s ease-out forwards;
            opacity: 0;
        }
        
        .animate-fade-in {
            animation: fadeIn 1s ease-out forwards;
            opacity: 0;
        }
        
        .animate-slide-in-left {
            animation: slideInFromLeft 0.6s ease-out forwards;
            opacity: 0;
        }
        
        .animate-delay-1 { animation-delay: 0.2s; }
        .animate-delay-2 { animation-delay: 0.4s; }
        .animate-delay-3 { animation-delay: 0.6s; }
        
        /* Hover animations */
        .search-form button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,230,255,.3);
        }
        
        .search-form input:focus {
            transform: scale(1.02);
            box-shadow: 0 0 20px rgba(0,230,255,.2);
        }
        
        .result:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,230,255,.1);
        }
        
        /* Smooth transitions */
        * {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .search-form{display:flex;gap:8px;margin-bottom:32px;max-width:700px}
        .search-form input{flex:1;padding:14px 16px;border-radius:12px;border:1px solid rgba(255,255,255,.25);background:rgba(6,18,38,.6);color:#fff;font-size:16px}
        .search-form input:focus{border-color:#00E6FF;box-shadow:0 0 0 3px rgba(0,230,255,.25);outline:none}
        .search-form button{padding:14px 18px;border-radius:12px;border:0;background:#00E6FF;color:#051324;font-weight:700;cursor:pointer}
        .search-form button:hover{background:#00CCE6}
        .results{margin-top:32px}
        .result{background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.1);border-radius:12px;padding:20px;margin-bottom:16px}
        .result-title{font-size:18px;font-weight:600;margin-bottom:8px;color:#00E6FF}
        .result-title a{color:inherit;text-decoration:none}
        .result-title a:hover{text-decoration:underline}
        .result-meta{color:#94A3B8;font-size:14px;margin-bottom:12px}
        .result-snippet{color:#E2E8F0;line-height:1.6}
        .result-score{color:#10B981;font-size:12px;font-weight:500;margin-top:8px}
        .result-score a{color:#10B981;text-decoration:none !important}
        .result-score a:hover{text-decoration:none !important}
        .loading{text-align:center;color:#94A3B8;padding:40px}
        .error{background:rgba(239,68,68,.1);border:1px solid rgba(239,68,68,.3);border-radius:8px;padding:16px;margin-bottom:16px;color:#FCA5A5}
        .no-results{text-align:center;color:#94A3B8;padding:40px}
        @media (max-width:700px){.nav{display:none}.search-form{flex-direction:column}}
    </style>
</head>
<body>
    <header class="site-header animate-slide-in-left">
        <a class="brand" href="/">Extraordinary Universe</a>
        <nav class="nav">
            <a href="/search">Search</a>
        </nav>
    </header>

    <main class="search-container">
        <h1 class="animate-fade-in-up animate-delay-1">Search the Universe</h1>
        <form class="search-form animate-fade-in-up animate-delay-2" id="searchForm">
            <input type="text" name="query" id="searchInput" placeholder="Try 'relativity', 'time dilation', 'consciousness'..." value="{{query}}" autofocus>
            <button type="submit">Search</button>
        </form>

        <div id="results" class="results">
            {% if results and results|length > 0 %}
                {% for result in results %}
                <div class="result">
                    <h3 class="result-title">
                        <a href="{{ result.link }}" target="_blank" rel="noopener noreferrer">{{ result.title }}</a>
                    </h3>
                    <div class="result-meta">
                        {{ result.pub_date if result.pub_date else 'Unknown date' }}
                    </div>
                    <div class="result-snippet">{{ result.snippet }}</div>
                    <div class="result-score">Score: {{ (result.score * 100) | round(1) }}%</div>
                </div>
                {% endfor %}
            {% else %}
                <div class="no-results">Enter a search term to find episodes</div>
            {% endif %}
        </div>
    </main>

    <script>
        const searchForm = document.getElementById('searchForm');
        const searchInput = document.getElementById('searchInput');
        const resultsDiv = document.getElementById('results');

        // Handle form submission
        searchForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const query = searchInput.value.trim();
            if (!query) return;

            // Show loading
            resultsDiv.innerHTML = '<div class="loading">Searching the universe...</div>';

            try {
                const response = await fetch('/api/search', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        query: query,
                        top_k: 10
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                displayResults(data);

            } catch (error) {
                console.error('Search error:', error);
                resultsDiv.innerHTML = `<div class="error">Search failed: ${error.message}</div>`;
            }
        });

        function displayResults(data) {
            resultsDiv.innerHTML = '';
            if (!data.results || data.results.length === 0) {
                const empty = document.createElement('div');
                empty.className = 'no-results';
                empty.textContent = 'No episodes found. Try different keywords.';
                resultsDiv.appendChild(empty);
                return;
            }

            data.results.forEach(result => {
                const container = document.createElement('div');
                container.className = 'result';

                const h3 = document.createElement('h3');
                h3.className = 'result-title';
                const a = document.createElement('a');
                a.href = result.link;
                a.target = '_blank';
                a.rel = 'noopener noreferrer';
                a.textContent = result.title || 'Untitled';
                h3.appendChild(a);

                const meta = document.createElement('div');
                meta.className = 'result-meta';
                try {
                    meta.textContent = result.pub_date ? new Date(result.pub_date).toLocaleDateString() : 'Unknown date';
                } catch (e) {
                    meta.textContent = 'Unknown date';
                }

                const snippet = document.createElement('div');
                snippet.className = 'result-snippet';
                snippet.textContent = result.snippet || '';

                const score = document.createElement('div');
                score.className = 'result-score';
                const s = (Number(result.score) || 0) * 100;
                score.textContent = `Score: ${s.toFixed(1)}%`;

                container.appendChild(h3);
                container.appendChild(meta);
                container.appendChild(snippet);
                container.appendChild(score);
                resultsDiv.appendChild(container);
            });
        }

        // Auto-search if query is in URL
        const urlParams = new URLSearchParams(window.location.search);
        const queryParam = urlParams.get('q');
        const hasSSRResults = {{ 'true' if results and results|length > 0 else 'false' }};
        if (queryParam && !hasSSRResults) {
            searchInput.value = queryParam;
            searchForm.dispatchEvent(new Event('submit'));
        }
    </script>
</body>
</html>
