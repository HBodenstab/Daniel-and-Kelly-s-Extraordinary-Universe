<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Browse Episodes - Daniel & Kelly's Extraordinary Universe</title>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif;background:linear-gradient(135deg,#0f172a 0%,#1e293b 100%);color:#E5EEF9;min-height:100vh}
        .site-header{max-width:72rem;margin:0 auto;padding:24px;display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid rgba(255,255,255,.08)}
        .brand{font-size:1.5rem;font-weight:700;color:#E5EEF9;text-decoration:none}
        .nav{display:flex;gap:32px}
        .nav a{color:#94a3b8;text-decoration:none;font-weight:500;transition:color .2s}
        .nav a:hover{color:#E5EEF9}
        .container{max-width:72rem;margin:0 auto;padding:48px 24px}
        .page-header{margin-bottom:48px;text-align:center}
        .page-title{font-size:3rem;font-weight:800;margin-bottom:16px;background:linear-gradient(135deg,#60a5fa 0%,#a78bfa 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
        .page-subtitle{font-size:1.25rem;color:#94a3b8;max-width:600px;margin:0 auto}
        .episodes-grid{display:grid;gap:24px;margin-bottom:48px}
        .episode-card{background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:24px;transition:all .2s}
        .episode-card:hover{background:rgba(255,255,255,.05);border-color:rgba(255,255,255,.12);transform:translateY(-2px)}
        .episode-title{font-size:1.25rem;font-weight:600;margin-bottom:8px;color:#E5EEF9}
        .episode-title a{color:inherit;text-decoration:none}
        .episode-title a:hover{color:#60a5fa}
        .episode-date{font-size:.875rem;color:#64748b;margin-bottom:12px}
        .episode-description{color:#cbd5e1;line-height:1.6}
        .pagination{display:flex;justify-content:center;align-items:center;gap:16px;margin-top:48px}
        .pagination a,.pagination span{display:inline-block;padding:8px 16px;border:1px solid rgba(255,255,255,.2);border-radius:8px;text-decoration:none;color:#94a3b8;transition:all .2s}
        .pagination a:hover{background:rgba(255,255,255,.05);color:#E5EEF9}
        .pagination .current{background:rgba(96,165,250,.1);border-color:rgba(96,165,250,.3);color:#60a5fa}
        .pagination .disabled{opacity:.5;cursor:not-allowed}
        .stats{text-align:center;color:#64748b;margin-bottom:32px}
        @media (max-width:768px){
            .episodes-grid{grid-template-columns:1fr}
            .page-title{font-size:2rem}
            .pagination{flex-wrap:wrap}
        }
        @media (min-width:769px){
            .episodes-grid{grid-template-columns:repeat(auto-fit,minmax(400px,1fr))}
        }
    </style>
</head>
<body>
    <header class="site-header">
        <a class="brand" href="/">Extraordinary Universe</a>
        <nav class="nav">
            <a href="/episodes">Episodes</a>
            <a href="/search">Search</a>
        </nav>
    </header>

    <main class="container">
        <div class="page-header">
            <h1 class="page-title">Browse Episodes</h1>
            <p class="page-subtitle">Explore all episodes from Daniel & Kelly's Extraordinary Universe</p>
        </div>

        <div class="stats" id="stats">
            Loading episodes...
        </div>

        <div class="episodes-grid" id="episodes-grid">
            <!-- Episodes will be populated by JavaScript -->
        </div>

        <div class="pagination" id="pagination">
            <!-- Pagination will be populated by JavaScript -->
        </div>
    </main>

    <script>
        // Parse the data injected by the server
        const episodes = JSON.parse('{{EPISODES}}');
        const pagination = JSON.parse('{{PAGINATION}}');

        function renderEpisodes() {
            const grid = document.getElementById('episodes-grid');
            const stats = document.getElementById('stats');
            
            // Update stats
            stats.textContent = `Showing ${episodes.length} episodes (${pagination.total_count} total)`;
            
            // Clear existing episodes
            grid.innerHTML = '';
            
            // Render episodes
            episodes.forEach(episode => {
                const card = document.createElement('div');
                card.className = 'episode-card';
                
                const date = episode.pub_date ? new Date(episode.pub_date).toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                }) : 'Date unknown';
                
                card.innerHTML = `
                    <h3 class="episode-title">
                        <a href="${episode.link}" target="_blank" rel="noopener noreferrer">
                            ${episode.title}
                        </a>
                    </h3>
                    <div class="episode-date">${date}</div>
                    <div class="episode-description">${episode.description || 'No description available.'}</div>
                `;
                
                grid.appendChild(card);
            });
        }

        function renderPagination() {
            const paginationEl = document.getElementById('pagination');
            
            if (pagination.total_pages <= 1) {
                paginationEl.style.display = 'none';
                return;
            }
            
            paginationEl.innerHTML = '';
            
            // Previous button
            if (pagination.has_prev) {
                const prevLink = document.createElement('a');
                prevLink.href = `/episodes?page=${pagination.prev_page}`;
                prevLink.textContent = '← Previous';
                paginationEl.appendChild(prevLink);
            } else {
                const prevSpan = document.createElement('span');
                prevSpan.className = 'disabled';
                prevSpan.textContent = '← Previous';
                paginationEl.appendChild(prevSpan);
            }
            
            // Page numbers
            const startPage = Math.max(1, pagination.page - 2);
            const endPage = Math.min(pagination.total_pages, pagination.page + 2);
            
            if (startPage > 1) {
                const firstLink = document.createElement('a');
                firstLink.href = '/episodes?page=1';
                firstLink.textContent = '1';
                paginationEl.appendChild(firstLink);
                
                if (startPage > 2) {
                    const ellipsis = document.createElement('span');
                    ellipsis.textContent = '...';
                    paginationEl.appendChild(ellipsis);
                }
            }
            
            for (let i = startPage; i <= endPage; i++) {
                if (i === pagination.page) {
                    const currentSpan = document.createElement('span');
                    currentSpan.className = 'current';
                    currentSpan.textContent = i;
                    paginationEl.appendChild(currentSpan);
                } else {
                    const pageLink = document.createElement('a');
                    pageLink.href = `/episodes?page=${i}`;
                    pageLink.textContent = i;
                    paginationEl.appendChild(pageLink);
                }
            }
            
            if (endPage < pagination.total_pages) {
                if (endPage < pagination.total_pages - 1) {
                    const ellipsis = document.createElement('span');
                    ellipsis.textContent = '...';
                    paginationEl.appendChild(ellipsis);
                }
                
                const lastLink = document.createElement('a');
                lastLink.href = `/episodes?page=${pagination.total_pages}`;
                lastLink.textContent = pagination.total_pages;
                paginationEl.appendChild(lastLink);
            }
            
            // Next button
            if (pagination.has_next) {
                const nextLink = document.createElement('a');
                nextLink.href = `/episodes?page=${pagination.next_page}`;
                nextLink.textContent = 'Next →';
                paginationEl.appendChild(nextLink);
            } else {
                const nextSpan = document.createElement('span');
                nextSpan.className = 'disabled';
                nextSpan.textContent = 'Next →';
                paginationEl.appendChild(nextSpan);
            }
        }

        // Initialize the page
        document.addEventListener('DOMContentLoaded', () => {
            renderEpisodes();
            renderPagination();
        });
    </script>
</body>
</html>
